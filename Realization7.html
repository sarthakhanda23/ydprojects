<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Plancast | Enterprise Execution OS</title>
    <style>
        /* -----------------------------------------------------------------------
        1. DESIGN TOKENS & ENTERPRISE CORE (Fusion of R3 & R5)
        -----------------------------------------------------------------------
        */
        :root {
            --yd-red: #a81818;
            --yd-red-hover: #8a1212;
            --yd-slate: #374151;
            --yd-dark: #0f172a;
            --bg-body: #f1f5f9;
            --bg-sidebar: #0f172a;
            --bg-card: #ffffff;
            --primary: #2563eb;
            --text-main: #1e293b;
            --text-muted: #64748b;
            --border: #e2e8f0;
            --success: #10b981;
            --warning: #f59e0b;
            --danger: #ef4444;
            --sidebar-width: 260px;
            --header-height: 64px;
            --trans-speed: 0.25s;
        }

        /* Executive Demo Mode (Preserved from R2 & R4) */
        body.demo-mode { --trans-speed: 0.8s; }
        body.demo-mode .kpi-card { animation: pulse-border 3s infinite; }
        @keyframes pulse-border {
            0% { box-shadow: 0 0 0 0px rgba(37, 99, 235, 0.1); }
            50% { box-shadow: 0 0 0 6px rgba(168, 24, 24, 0.2); }
            100% { box-shadow: 0 0 0 0px rgba(37, 99, 235, 0); }
        }

        * { box-sizing: border-box; outline: none; }
        body {
            margin: 0; font-family: 'Inter', -apple-system, sans-serif;
            background-color: var(--bg-body); color: var(--text-main);
            height: 100vh; overflow: hidden; display: flex; font-size: 13px;
        }

        /* -----------------------------------------------------------------------
        2. LAYOUT COMPONENTS (Shell & Identity)
        -----------------------------------------------------------------------
        */
        #sidebar {
            width: var(--sidebar-width); background: var(--bg-sidebar);
            color: #d1d5db; display: flex; flex-direction: column;
            flex-shrink: 0; z-index: 50; transition: width var(--trans-speed);
        }
        .sidebar-brand {
            height: 70px; display: flex; align-items: center; padding: 0 20px;
            background: rgba(0,0,0,0.2); border-bottom: 1px solid rgba(255,255,255,0.05);
        }
        .sidebar-brand img { height: 40px; width: auto; object-fit: contain; }
        
        .nav-section { margin-top: 20px; flex-grow: 1; overflow-y: auto; }
        .nav-label {
            text-transform: uppercase; font-size: 11px; font-weight: 700;
            color: #64748b; padding: 0 24px; margin-bottom: 8px;
        }
        .nav-item {
            display: flex; align-items: center; padding: 12px 24px;
            cursor: pointer; transition: all 0.2s; color: #94a3b8;
            border-left: 3px solid transparent;
        }
        .nav-item:hover { background: rgba(255,255,255,0.05); color: white; }
        .nav-item.active {
            background: rgba(168, 24, 24, 0.15); color: white;
            border-left-color: var(--yd-red);
        }

        #main-wrapper { flex: 1; display: flex; flex-direction: column; position: relative; }
        header {
            height: var(--header-height); background: white;
            border-bottom: 1px solid var(--border); display: flex;
            align-items: center; justify-content: space-between; padding: 0 32px;
        }
        #content-canvas { flex: 1; overflow-y: auto; padding: 32px; }

        /* -----------------------------------------------------------------------
        3. MODULE SPECIFIC UI (KPIs, Tables, Gantt)
        -----------------------------------------------------------------------
        */
        .grid-4 { display: grid; grid-template-columns: repeat(4, 1fr); gap: 24px; margin-bottom: 24px; }
        .card { background: white; border: 1px solid var(--border); border-radius: 8px; padding: 20px; box-shadow: 0 1px 3px rgba(0,0,0,0.05); }
        
        .kpi-card { position: relative; overflow: hidden; }
        .kpi-card::after { content:''; position: absolute; top:0; left:0; width: 4px; height: 100%; background: var(--yd-red); }
        .kpi-value { font-size: 26px; font-weight: 700; margin: 8px 0; }

        /* PMO-Grade Tables */
        table { width: 100%; border-collapse: collapse; }
        th { text-align: left; padding: 12px 16px; border-bottom: 2px solid var(--border); background: #f8fafc; font-size: 11px; text-transform: uppercase; color: var(--text-muted); }
        td { padding: 12px 16px; border-bottom: 1px solid var(--border); }
        tr:hover td { background: #f1f5f9; cursor: pointer; }

        /* Gantt & Fever Chart Visuals (SVG Core) */
        .svg-container { background: white; border: 1px solid var(--border); border-radius: 4px; overflow: auto; }
        .gantt-bar { rx: 4; cursor: pointer; transition: filter 0.2s; }
        .gantt-connector { stroke: #cbd5e1; stroke-width: 1.5; fill: none; }
        .fever-zone-red { fill: #fee2e2; }
        .fever-zone-yellow { fill: #fef3c7; }
        .fever-zone-green { fill: #dcfce7; }

        /* Login & Modals */
        #login-overlay {
            position: fixed; inset: 0; background: var(--yd-dark);
            z-index: 1000; display: flex; align-items: center; justify-content: center;
        }
        .login-box {
            background: white; padding: 40px; border-radius: 12px;
            width: 400px; text-align: center;
        }

        .modal-overlay {
            position: fixed; inset: 0; background: rgba(0,0,0,0.5);
            display: none; align-items: center; justify-content: center; z-index: 2000;
        }
        .modal-overlay.open { display: flex; }
        .modal-content { background: white; width: 800px; border-radius: 8px; max-height: 90vh; overflow-y: auto; padding: 30px; }

        /* Badges */
        .badge { padding: 4px 8px; border-radius: 12px; font-size: 10px; font-weight: 700; text-transform: uppercase; }
        .badge-red { background: #fee2e2; color: #b91c1c; }
        .badge-yellow { background: #fef3c7; color: #92400e; }
        .badge-green { background: #dcfce7; color: #166534; }

        /* Tab System for Detail View */
        .tab-nav { display: flex; gap: 20px; border-bottom: 1px solid var(--border); margin-bottom: 20px; }
        .tab-link { padding: 10px 0; cursor: pointer; color: var(--text-muted); font-weight: 600; border-bottom: 2px solid transparent; }
        .tab-link.active { color: var(--yd-red); border-bottom-color: var(--yd-red); }
    </style>
</head>
<body>

    <div id="login-overlay">
        <div class="login-box">
            <img src="YDLOGO.png" alt="Plancast Logo" style="width: 120px; margin-bottom: 20px;">
            <h2 style="margin: 0 0 10px 0;">Plancast OS</h2>
            <p style="color: var(--text-muted); margin-bottom: 30px;">Enterprise Execution Control Room</p>
            <input type="text" value="admin@yogijidigi.com" style="width:100%; padding:12px; margin-bottom:15px; border:1px solid var(--border); border-radius:4px;">
            <input type="password" value="password" style="width:100%; padding:12px; margin-bottom:25px; border:1px solid var(--border); border-radius:4px;">
            <button onclick="App.Auth.login()" style="width:100%; padding:14px; background:var(--yd-red); color:white; border:none; border-radius:4px; font-weight:700; cursor:pointer;">Initialize Workspace</button>
        </div>
    </div>

    <div id="sidebar">
        <div class="sidebar-brand">
            <img src="YDLOGO.png" alt="Plancast">
        </div>
        <div class="nav-section">
            <div class="nav-label">Portfolio Control</div>
            <div class="nav-item active" data-view="dashboard" onclick="App.Router.go('dashboard')">Portfolio Dashboard</div>
            <div class="nav-item" data-view="projects" onclick="App.Router.go('projects')">Project Registry</div>
            
            <div class="nav-label" style="margin-top:20px;">Execution Intelligence</div>
            <div class="nav-item" data-view="critical" onclick="App.Router.go('critical')">Critical Chain (CCPM)</div>
            <div class="nav-item" data-view="fullkit" onclick="App.Router.go('fullkit')">Full-Kit Readiness</div>
            
            <div class="nav-label" style="margin-top:20px;">Operations</div>
            <div class="nav-item" onclick="App.UI.toggleDemo()">Presentation Mode</div>
            <div class="nav-item" onclick="App.Store.reset()">Reset System Data</div>
        </div>
    </div>

    <div id="main-wrapper">
        <header>
            <div id="breadcrumbs" style="color: var(--text-muted);">Portfolio / <span style="color:var(--text-main); font-weight:700;">Dashboard</span></div>
            <div style="display:flex; align-items:center; gap:20px;">
                <div id="demo-indicator" class="badge" style="display:none; background: #eff6ff; color: #2563eb;">Executive Demo Active</div>
                <div style="text-align:right;">
                    <div style="font-weight:700; font-size:12px;">Harvey Specter</div>
                    <div style="font-size:10px; color:var(--text-muted);">Senior Program Director</div>
                </div>
                <div style="width:36px; height:36px; background:var(--yd-red); border-radius:50%; display:flex; align-items:center; justify-content:center; color:white; font-weight:700;">HS</div>
            </div>
        </header>

        <div id="content-canvas">
            </div>
    </div>

    <div id="detail-modal" class="modal-overlay">
        <div class="modal-content">
            <div id="modal-header-area" style="display:flex; justify-content:space-between; align-items:flex-start; margin-bottom:20px;">
                </div>
            <div class="tab-nav">
                <div class="tab-link active" onclick="App.UI.switchTab(this, 'overview')">Overview</div>
                <div class="tab-link" onclick="App.UI.switchTab(this, 'gantt')">Timeline (Gantt)</div>
                <div class="tab-link" onclick="App.UI.switchTab(this, 'ccpm')">CCPM Analytics</div>
                <div class="tab-link" onclick="App.UI.switchTab(this, 'bom')">Assemblies & BOM</div>
                <div class="tab-link" onclick="App.UI.switchTab(this, 'flow')">Execution Flow</div>
            </div>
            <div id="tab-body">
                </div>
            <div style="margin-top:30px; text-align:right;">
                <button onclick="App.UI.closeModal()" style="padding:10px 20px; border:1px solid var(--border); border-radius:4px; cursor:pointer;">Close Perspective</button>
            </div>
        </div>
    </div>

    <script>
    /* ---------------------------------------------------------------------------
    4. DATA ENGINE (The "JS Store" - Consolidated from R1, R5, R6)
    ---------------------------------------------------------------------------
    */
    const App = {
        Store: {
            DB_KEY: 'PLANCAST_MASTER_DB',
            state: null,

            init() {
                const raw = localStorage.getItem(this.DB_KEY);
                if (!raw) this.seed();
                else this.state = JSON.parse(raw);
            },

            seed() {
                const projects = [];
                const prefixes = ["N-2221", "N-2207", "N-2305", "N-2424", "N-2502"];
                const types = ["4HI CRM 400MM", "6HI CRM 1500 MM", "SKIN PASS MILL", "PICKLING LINE"];
                
                // Generating 60 Large-Scale Industrial Projects
                for (let i = 0; i < 60; i++) {
                    const progress = Math.floor(Math.random() * 90);
                    const buffer = Math.floor(Math.random() * 100);
                    let status = 'GREEN';
                    if (buffer > progress + 20) status = 'RED';
                    else if (buffer > progress) status = 'YELLOW';

                    projects.push({
                        id: 'PRJ-' + (1000 + i),
                        code: prefixes[i % 5] + "-" + (100 + i),
                        name: `${prefixes[i % 5]} ${types[i % 4]} Installation`,
                        manager: ["Aditya Saini", "Mayank Bandha", "Sarthak Handa"][i % 3],
                        status: status,
                        progress: progress,
                        bufferConsumed: buffer,
                        budget: (Math.random() * 500).toFixed(2),
                        actual: (Math.random() * 400).toFixed(2),
                        startDate: '2025-01-10',
                        assemblies: this.seedAssemblies(i)
                    });
                }
                this.state = { projects, config: { demoMode: false } };
                this.save();
            },

            seedAssemblies(pIdx) {
                const assys = ["Mill Housing", "Uncoiler Assy", "Recoiler Assy", "Hydraulic Pack"];
                return assys.map((name, i) => ({
                    id: `ASY-${pIdx}-${i}`,
                    name: name,
                    fullKit: Math.random() > 0.3,
                    progress: Math.floor(Math.random() * 100),
                    bom: [
                        { item: "Housing Casting", qty: 2, status: "Received" },
                        { item: "Bearing Block", qty: 4, status: "Ordered" },
                        { item: "Shim Set", qty: 12, status: "Pending" }
                    ]
                }));
            },

            save() { localStorage.setItem(this.DB_KEY, JSON.stringify(this.state)); },
            reset() { if(confirm("Wipe all Program Data and re-seed?")) { localStorage.removeItem(this.DB_KEY); location.reload(); } }
        },

        /* ---------------------------------------------------------------------------
        5. ROUTER & VIEW ENGINE (Fusion of all Realizations)
        ---------------------------------------------------------------------------
        */
        Router: {
            go(view) {
                const canvas = document.getElementById('content-canvas');
                const bread = document.getElementById('breadcrumbs');
                
                document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active'));
                const activeNav = document.querySelector(`.nav-item[data-view="${view}"]`);
                if(activeNav) activeNav.classList.add('active');

                switch(view) {
                    case 'dashboard':
                        bread.innerHTML = `Portfolio / <span style="color:var(--text-main); font-weight:700;">Executive Dashboard</span>`;
                        App.Views.Dashboard(canvas);
                        break;
                    case 'projects':
                        bread.innerHTML = `Registry / <span style="color:var(--text-main); font-weight:700;">Project Control Center</span>`;
                        App.Views.ProjectList(canvas);
                        break;
                    case 'critical':
                        bread.innerHTML = `CCPM / <span style="color:var(--text-main); font-weight:700;">Portfolio Fever Chart</span>`;
                        App.Views.CriticalChain(canvas);
                        break;
                    case 'fullkit':
                        bread.innerHTML = `Supply Chain / <span style="color:var(--text-main); font-weight:700;">Full-Kit Readiness</span>`;
                        App.Views.FullKit(canvas);
                        break;
                }
            }
        },

        /* ---------------------------------------------------------------------------
        6. CORE VIEWS (Completeness & Fidelity)
        ---------------------------------------------------------------------------
        */
        Views: {
            Dashboard(el) {
                const s = App.Store.state;
                const totalProjects = s.projects.length;
                const critical = s.projects.filter(p => p.status === 'RED').length;
                const totalBudget = s.projects.reduce((acc, p) => acc + parseFloat(p.budget), 0).toFixed(2);

                el.innerHTML = `
                    <div class="grid-4">
                        <div class="card kpi-card">
                            <div style="color:var(--text-muted); font-size:11px; font-weight:700; text-transform:uppercase;">Program Capacity</div>
                            <div class="kpi-value">${totalProjects} Projects</div>
                            <div style="font-size:11px; color:var(--success);">▲ 4 Activated this month</div>
                        </div>
                        <div class="card kpi-card">
                            <div style="color:var(--text-muted); font-size:11px; font-weight:700; text-transform:uppercase;">Portfolio Value</div>
                            <div class="kpi-value">₹${totalBudget} Cr</div>
                            <div style="font-size:11px; color:var(--text-muted);">Total Capital Expenditure</div>
                        </div>
                        <div class="card kpi-card" style="border-left-color: var(--danger);">
                            <div style="color:var(--text-muted); font-size:11px; font-weight:700; text-transform:uppercase;">Critical Alerts</div>
                            <div class="kpi-value" style="color:var(--danger);">${critical} Projects</div>
                            <div style="font-size:11px; color:var(--danger);">Immediate Intervention Required</div>
                        </div>
                        <div class="card kpi-card">
                            <div style="color:var(--text-muted); font-size:11px; font-weight:700; text-transform:uppercase;">Resource Index</div>
                            <div class="kpi-value">92%</div>
                            <div style="font-size:11px; color:var(--success);">Optimal Range</div>
                        </div>
                    </div>

                    <div style="display:grid; grid-template-columns: 2fr 1fr; gap:24px;">
                        <div class="card">
                            <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:20px;">
                                <h3 style="margin:0;">Portfolio Fever Chart (CCPM)</h3>
                                <button class="badge" style="border:1px solid var(--border); background:white; cursor:pointer;" onclick="App.Router.go('critical')">Expand View</button>
                            </div>
                            <div id="dashboard-fever-svg" style="height:350px;"></div>
                        </div>
                        <div class="card">
                            <h3 style="margin:0 0 20px 0;">Supply Chain Alerts</h3>
                            <table style="font-size:12px;">
                                ${s.projects.slice(0, 8).map(p => `
                                    <tr>
                                        <td>${p.code}</td>
                                        <td><span class="badge ${p.status === 'RED' ? 'badge-red' : 'badge-green'}">${p.status}</span></td>
                                    </tr>
                                `).join('')}
                            </table>
                        </div>
                    </div>
                `;
                App.Charts.drawFeverChart('dashboard-fever-svg', s.projects);
            },

            ProjectList(el) {
                const s = App.Store.state;
                el.innerHTML = `
                    <div class="card">
                        <div style="display:flex; justify-content:space-between; margin-bottom:20px;">
                            <h2 style="margin:0;">Portfolio Master Registry</h2>
                            <input type="text" placeholder="Search Program Codes..." style="padding:8px; border:1px solid var(--border); border-radius:4px; width:300px;">
                        </div>
                        <table>
                            <thead>
                                <tr>
                                    <th>Status</th>
                                    <th>Program Code</th>
                                    <th>Initiative Name</th>
                                    <th>Program Lead</th>
                                    <th>Completion</th>
                                    <th>Buffer Usage</th>
                                    <th>Action</th>
                                </tr>
                            </thead>
                            <tbody>
                                ${s.projects.map(p => `
                                    <tr onclick="App.UI.openProject('${p.id}')">
                                        <td><span class="badge ${p.status === 'RED' ? 'badge-red' : (p.status === 'YELLOW' ? 'badge-yellow' : 'badge-green')}">${p.status}</span></td>
                                        <td style="font-weight:700;">${p.code}</td>
                                        <td>${p.name}</td>
                                        <td>${p.manager}</td>
                                        <td>
                                            <div style="width:100px; height:6px; background:#e2e8f0; border-radius:3px; overflow:hidden;">
                                                <div style="width:${p.progress}%; height:100%; background:var(--yd-red);"></div>
                                            </div>
                                        </td>
                                        <td>
                                            <div style="font-size:10px; color:${p.bufferConsumed > 80 ? 'var(--danger)' : 'var(--text-muted)'}">${p.bufferConsumed}% Consumed</div>
                                        </td>
                                        <td><button style="background:none; border:none; color:var(--primary); font-weight:700; cursor:pointer;">Analyze</button></td>
                                    </tr>
                                `).join('')}
                            </tbody>
                        </table>
                    </div>
                `;
            },

            CriticalChain(el) {
                el.innerHTML = `
                    <div class="card">
                        <h2 style="margin:0 0 20px 0;">Program Fever Chart (Buffer Health Index)</h2>
                        <div id="full-fever-svg" style="height:600px; width:100%;"></div>
                        <div style="margin-top:20px; display:flex; gap:30px; justify-content:center;">
                            <div style="display:flex; align-items:center; gap:8px;"><div style="width:12px; height:12px; background:#fee2e2; border:1px solid #ef4444;"></div> Critical Zone</div>
                            <div style="display:flex; align-items:center; gap:8px;"><div style="width:12px; height:12px; background:#fef3c7; border:1px solid #f59e0b;"></div> Warning Zone</div>
                            <div style="display:flex; align-items:center; gap:8px;"><div style="width:12px; height:12px; background:#dcfce7; border:1px solid #10b981;"></div> Safe Zone</div>
                        </div>
                    </div>
                `;
                App.Charts.drawFeverChart('full-fever-svg', App.Store.state.projects);
            },

            FullKit(el) {
                const s = App.Store.state;
                el.innerHTML = `
                    <div class="card">
                        <h2 style="margin:0 0 20px 0;">Assembly Full-Kit Readiness Matrix</h2>
                        <table>
                            <thead>
                                <tr>
                                    <th>Parent Project</th>
                                    <th>Assembly Component</th>
                                    <th>Design Kit</th>
                                    <th>Materials Kit</th>
                                    <th>Execution Progress</th>
                                    <th>Readiness Status</th>
                                </tr>
                            </thead>
                            <tbody>
                                ${s.projects.slice(0, 20).map(p => p.assemblies.map(a => `
                                    <tr>
                                        <td>${p.code}</td>
                                        <td style="font-weight:700;">${a.name}</td>
                                        <td><span class="badge ${a.fullKit ? 'badge-green' : 'badge-red'}">${a.fullKit ? 'Released' : 'Locked'}</span></td>
                                        <td><span class="badge ${a.fullKit ? 'badge-green' : 'badge-yellow'}">${a.fullKit ? 'Complete' : 'Partial'}</span></td>
                                        <td>${a.progress}%</td>
                                        <td>${a.fullKit && a.progress < 100 ? '<span style="color:var(--success);">READY TO EXECUTE</span>' : '<span style="color:var(--text-muted);">BLOCKED</span>'}</td>
                                    </tr>
                                `).join('')).join('')}
                            </tbody>
                        </table>
                    </div>
                `;
            }
        },

        /* ---------------------------------------------------------------------------
        7. VISUALIZATION ENGINE (SVG Graphs & Charts)
        ---------------------------------------------------------------------------
        */
        Charts: {
            drawFeverChart(id, projects) {
                const el = document.getElementById(id);
                if(!el) return;
                const w = el.clientWidth;
                const h = el.clientHeight;

                let svg = `<svg width="100%" height="100%" viewBox="0 0 ${w} ${h}" preserveAspectRatio="none">
                    <path d="M 0 ${h} L ${w} ${h} L ${w} 0 L 0 0 Z" class="fever-zone-green" />
                    <path d="M 0 ${h} L ${w} ${h*0.5} L ${w} 0 L 0 0 Z" class="fever-zone-yellow" />
                    <path d="M 0 ${h} L ${w} ${h*0.2} L ${w} 0 L 0 0 Z" class="fever-zone-red" />
                    
                    <line x1="0" y1="${h}" x2="${w}" y2="${h}" stroke="#ccc" stroke-width="2" />
                    <line x1="0" y1="0" x2="0" y2="${h}" stroke="#ccc" stroke-width="2" />
                `;

                projects.forEach(p => {
                    const cx = (p.progress / 100) * w;
                    const cy = h - ((p.bufferConsumed / 100) * h);
                    const color = p.status === 'RED' ? '#ef4444' : (p.status === 'YELLOW' ? '#f59e0b' : '#10b981');
                    svg += `<circle cx="${cx}" cy="${cy}" r="5" fill="${color}" stroke="white" stroke-width="1">
                        <title>${p.code}: ${p.progress}% Complete</title>
                    </circle>`;
                });

                svg += `
                    <text x="${w/2}" y="${h-10}" text-anchor="middle" font-size="12" fill="#64748b">Program Chain Completion %</text>
                    <text x="15" y="${h/2}" transform="rotate(-90 15,${h/2})" text-anchor="middle" font-size="12" fill="#64748b">Buffer Consumed %</text>
                </svg>`;
                el.innerHTML = svg;
            }
        },

        /* ---------------------------------------------------------------------------
        8. UI & MODAL SYSTEM (Tabs, Drills, Interactions)
        ---------------------------------------------------------------------------
        */
        UI: {
            currentProjectId: null,

            openProject(id) {
                const p = App.Store.state.projects.find(proj => proj.id === id);
                this.currentProjectId = id;
                const modal = document.getElementById('detail-modal');
                const header = document.getElementById('modal-header-area');
                
                header.innerHTML = `
                    <div>
                        <div style="font-size:11px; font-weight:700; color:var(--text-muted); text-transform:uppercase;">Program Perspective</div>
                        <h1 style="margin:5px 0;">${p.code}: ${p.name}</h1>
                        <div style="display:flex; gap:15px; color:var(--text-muted);">
                            <span>Lead: <strong>${p.manager}</strong></span>
                            <span>Budget: <strong>₹${p.budget} Cr</strong></span>
                        </div>
                    </div>
                    <div style="text-align:right;">
                        <span class="badge ${p.status === 'RED' ? 'badge-red' : 'badge-green'}" style="font-size:14px; padding:8px 16px;">Status: ${p.status}</span>
                        <div style="margin-top:10px; font-weight:700;">Overall Progress: ${p.progress}%</div>
                    </div>
                `;

                modal.classList.add('open');
                this.switchTab(document.querySelector('.tab-link'), 'overview');
            },

            switchTab(el, tab) {
                document.querySelectorAll('.tab-link').forEach(l => l.classList.remove('active'));
                el.classList.add('active');
                
                const body = document.getElementById('tab-body');
                const p = App.Store.state.projects.find(proj => proj.id === this.currentProjectId);

                if (tab === 'overview') {
                    body.innerHTML = `
                        <div style="display:grid; grid-template-columns: 1fr 1fr; gap:30px; margin-top:20px;">
                            <div class="card">
                                <h3>Executive Narrative</h3>
                                <p style="line-height:1.6; color:var(--yd-slate);">Project ${p.code} is currently in the <strong>Execution Phase</strong>. Engineering milestones for the Mill Housing have been cleared. We are tracking a variance in procurement for long-lead bearings.</p>
                                <div style="margin-top:20px; padding:15px; background:#f8fafc; border-radius:4px;">
                                    <strong>Latest Intervention:</strong> Expedited PO for Hydraulic Pack via Sarthak Handa.
                                </div>
                            </div>
                            <div class="card">
                                <h3>Buffer Performance</h3>
                                <div style="font-size:40px; font-weight:700; color:${p.status === 'RED' ? 'var(--danger)' : 'var(--success)'}">${100 - p.bufferConsumed}%</div>
                                <div style="color:var(--text-muted); text-transform:uppercase; font-size:11px; font-weight:700;">Buffer Remaining</div>
                                <div style="margin-top:20px; height:20px; display:flex; border-radius:10px; overflow:hidden;">
                                    <div style="width:33%; background:#dcfce7;"></div>
                                    <div style="width:33%; background:#fef3c7;"></div>
                                    <div style="width:34%; background:#fee2e2;"></div>
                                </div>
                            </div>
                        </div>
                    `;
                } else if (tab === 'bom') {
                    body.innerHTML = `
                        <h3 style="margin-top:20px;">Industrial Assembly Tree</h3>
                        ${p.assemblies.map(a => `
                            <div class="card" style="margin-bottom:15px;">
                                <div style="display:flex; justify-content:space-between; margin-bottom:15px;">
                                    <strong>${a.name}</strong>
                                    <span class="badge ${a.fullKit ? 'badge-green' : 'badge-red'}">Full-Kit: ${a.fullKit ? 'Released' : 'Locked'}</span>
                                </div>
                                <table>
                                    ${a.bom.map(item => `
                                        <tr>
                                            <td>${item.item}</td>
                                            <td>Qty: ${item.qty}</td>
                                            <td><span class="badge ${item.status === 'Received' ? 'badge-green' : 'badge-yellow'}">${item.status}</span></td>
                                        </tr>
                                    `).join('')}
                                </table>
                            </div>
                        `).join('')}
                    `;
                } else {
                    body.innerHTML = `<div style="padding:50px; text-align:center; color:var(--text-muted);">
                        <div style="font-size:20px;">Module Under Construction</div>
                        <div>Fidelity Level: High. Awaiting specific simulation parameters for ${tab}.</div>
                    </div>`;
                }
            },

            closeModal() { document.getElementById('detail-modal').classList.remove('open'); },
            toggleDemo() {
                document.body.classList.toggle('demo-mode');
                const active = document.body.classList.contains('demo-mode');
                document.getElementById('demo-indicator').style.display = active ? 'block' : 'none';
            }
        },

        /* ---------------------------------------------------------------------------
        9. AUTH & BOOTSTRAP
        ---------------------------------------------------------------------------
        */
        Auth: {
            login() {
                document.getElementById('login-overlay').style.display = 'none';
                App.Store.init();
                App.Router.go('dashboard');
            }
        }
    };

    // System Entry Point
    window.onload = () => {
        // Auth is default state on refresh. 
        // Logic handled in App.Auth.login
    };
    </script>
</body>
</html>